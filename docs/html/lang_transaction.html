<!DOCTYPE html>
<html><head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link href="sqlite.css" rel="stylesheet">
<title>Transaction</title>

<!-- path= -->
</head>
<body>
<div class=nosearch>
<a href="index.html">
<img class="logo" src="images/sqlite370_banner.gif" alt="SQLite" border="0">
</a>
<div><!-- IE hack to prevent disappearing logo -->
</div>
<div class="tagline desktoponly">
Small. Fast. Reliable.<br>Choose any three.
</div>
<div class="menu mainmenu">
<ul>
<li><a href="index.html">Home</a>
<li class='mobileonly'><a href="javascript:void(0)" onclick='toggle_div("submenu")'>Menu</a>
<li class='wideonly'><a href='about.html'>About</a>
<li class='desktoponly'><a href="docs.html">Documentation</a>
<li class='desktoponly'><a href="download.html">Download</a>
<li class='wideonly'><a href='copyright.html'>License</a>
<li class='desktoponly'><a href="support.html">Support</a>
<li class='desktoponly'><a href="prosupport.html">Purchase</a>
<li class='search' id='search_menubutton'>
<a href="javascript:void(0)" onclick='toggle_search()'>Search</a>
</ul>
</div>
<div class="menu submenu" id="submenu">
<ul>
<li><a href='about.html'>About</a>
<li><a href='docs.html'>Documentation</a>
<li><a href='download.html'>Download</a>
<li><a href='support.html'>Support</a>
<li><a href='prosupport.html'>Purchase</a>
</ul>
</div>
<div class="searchmenu" id="searchmenu">
<form method="GET" action="search">
<select name="s" id="searchtype">
<option value="d">Search Documentation</option>
<option value="c">Search Changelog</option>
</select> <input type="text" name="q" id="searchbox" value=""/> <input
type="submit" value="Go"/>
</form>
</div>
</div>
<script>
function toggle_div(nm) { var w = document.getElementById(nm); if(
w.style.display=="block" ){ w.style.display = "none"; }else{ w.style.display
= "block"; } } function toggle_search() { var w =
document.getElementById("searchmenu"); if( w.style.display=="block" ){
w.style.display = "none"; } else { w.style.display = "block";
setTimeout(function(){ document.getElementById("searchbox").focus()  }, 30);
} } function div_off(nm){document.getElementById(nm).style.display="none";}
window.onbeforeunload = function(e){div_off("submenu");}; /* Disable the
Search feature if we are not operating from CGI, since */ /* Search is
accomplished using CGI and will not work without it. */ if( !location.origin
|| !location.origin.match || !location.origin.match(/http/) ){
document.getElementById("search_menubutton").style.display = "none"; } /*
Used by the Hide/Show button beside syntax diagrams, to toggle the */
function hideorshow(btn,obj){ var x = document.getElementById(obj); var b =
document.getElementById(btn); if( x.style.display!='none' ){ x.style.display
= 'none'; b.innerHTML='show'; }else{ x.style.display = '';
b.innerHTML='hide'; } return false; } var antiRobot = 0; function
antiRobotGo(){ if( antiRobot!=3 ) return; antiRobot = 7; var j =
document.getElementById("mtimelink"); if(j && j.hasAttribute("data-href"))
j.href=j.getAttribute("data-href"); } function antiRobotDefense(){
document.body.onmousedown=function(){ antiRobot |= 2; antiRobotGo();
document.body.onmousedown=null; }; document.body.onmousemove=function(){
antiRobot |= 2; antiRobotGo(); document.body.onmousemove=null; };
setTimeout(function(){ antiRobot |= 1; antiRobotGo(); }, 100);
antiRobotGo(); } antiRobotDefense();
</script>
<div class=fancy>
<div class=nosearch>
<div class="fancy_title">
Transaction
</div>
</div>




<h1 id="transaction_control_syntax"><span>1. </span>トランザクション制御文法</h1>

<p><b><a href="syntax/begin-stmt.html">begin-stmt:</a></b> <button
id='xe414e5c1' onclick='hideorshow("xe414e5c1","xf7b9c104")'>hide</button></p>
 <div id='xf7b9c104' class='imgcontainer'>
 <div style="max-width:560px"><svg xmlns='http://www.w3.org/2000/svg' class="pikchr" viewBox="0 0 560.669 140.4">
<circle cx="5" cy="17" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="32,17 20,21 20,12" style="fill:rgb(0,0,0)"/>
<path d="M9,17L26,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M47,32L86,32A15 15 0 0 0 101 17A15 15 0 0 0 86 2L47,2A15 15 0 0 0 32 17A15 15 0 0 0 47 32Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="66" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">BEGIN</text>
<polygon points="124,17 112,21 112,12" style="fill:rgb(0,0,0)"/>
<path d="M101,17L118,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="162,123 150,127 150,118" style="fill:rgb(0,0,0)"/>
<path d="M124,17 L 131,17 Q 139,17 139,32 L 139,108 Q 139,123 147,123 L 156,123"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M177,138L261,138A15 15 0 0 0 276 123A15 15 0 0 0 261 108L177,108A15 15 0 0 0 162 123A15 15 0 0 0 177 138Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="219" y="123" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">EXCLUSIVE</text>
<polygon points="299,123 287,127 287,118" style="fill:rgb(0,0,0)"/>
<path d="M276,123L293,123"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="337,17 325,21 325,12" style="fill:rgb(0,0,0)"/>
<path d="M299,123 L 306,123 Q 314,123 314,108 L 314,32 Q 314,17 322,17 L 331,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="373,17 361,21 361,12" style="fill:rgb(0,0,0)"/>
<path d="M337,17L367,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M388,32L500,32A15 15 0 0 0 515 17A15 15 0 0 0 500 2L388,2A15 15 0 0 0 373 17A15 15 0 0 0 388 32Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="444" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">TRANSACTION</text>
<polygon points="551,17 539,21 539,12" style="fill:rgb(0,0,0)"/>
<path d="M515,17L545,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<circle cx="554" cy="17" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="444,47 432,51 432,43" style="fill:rgb(0,0,0)"/>
<path d="M337,17 L 344,17 Q 352,17 352,32 L 352,32 Q 352,47 367,47 L 423,47 L 438,47"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M444,47 L 511,47 Q 526,47 526,32 L 526,32 Q 526,17 533,17 L 541,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M124,17L325,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="162,47 150,51 150,43" style="fill:rgb(0,0,0)"/>
<path d="M139,32 L 139,39 Q 139,47 147,47 L 156,47"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M177,62L257,62A15 15 0 0 0 272 47L272,47A15 15 0 0 0 257 32L177,32A15 15 0 0 0 162 47L162,47A15 15 0 0 0 177 62Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="217" y="47" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">DEFERRED</text>
<polygon points="295,47 284,51 284,43" style="fill:rgb(0,0,0)"/>
<path d="M272,47L289,47"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M295,47 L 304,47 Q 314,47 314,40 L 314,32"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="162,85 150,89 150,81" style="fill:rgb(0,0,0)"/>
<path d="M139,32 L 139,70 Q 139,85 147,85 L 156,85"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M177,100L265,100A15 15 0 0 0 281 85A15 15 0 0 0 265 70L177,70A15 15 0 0 0 162 85A15 15 0 0 0 177 100Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="221" y="85" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">IMMEDIATE</text>
<polygon points="304,85 292,89 292,81" style="fill:rgb(0,0,0)"/>
<path d="M281,85L298,85"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M304,85 L 309,85 Q 314,85 314,77 L 314,70"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
</svg>
</div>
</div>
<p><b><a href="syntax/commit-stmt.html">commit-stmt:</a></b> <button
id='x2b8fc0fd' onclick='hideorshow("x2b8fc0fd","xb3d5e3ac")'>hide</button></p>
 <div id='xb3d5e3ac' class='imgcontainer'>
 <div style="max-width:434px"><svg xmlns='http://www.w3.org/2000/svg' class="pikchr" viewBox="0 0 434.506 72.36">
<circle cx="5" cy="17" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="32,17 20,21 20,12" style="fill:rgb(0,0,0)"/>
<path d="M9,17L26,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="68,17 56,21 56,12" style="fill:rgb(0,0,0)"/>
<path d="M32,17L62,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M83,32L141,32A15 15 0 0 0 157 17A15 15 0 0 0 141 2L83,2A15 15 0 0 0 68 17A15 15 0 0 0 83 32Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="112" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">COMMIT</text>
<polygon points="202,17 190,21 190,12" style="fill:rgb(0,0,0)"/>
<path d="M157,17L196,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M202,17L238,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M253,32L365,32A15 15 0 0 0 380 17A15 15 0 0 0 365 2L253,2A15 15 0 0 0 238 17A15 15 0 0 0 253 32Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="309" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">TRANSACTION</text>
<polygon points="425,17 413,21 413,12" style="fill:rgb(0,0,0)"/>
<path d="M380,17L419,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<circle cx="428" cy="17" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M83,70L104,70A15 15 0 0 0 119 55L119,55A15 15 0 0 0 104 39L83,39A15 15 0 0 0 68 55L68,55A15 15 0 0 0 83 70Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="94" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">END</text>
<polygon points="68,55 56,59 56,50" style="fill:rgb(0,0,0)"/>
<path d="M32,17 L 39,17 Q 47,17 47,32 L 47,40 Q 47,55 55,55 L 62,55"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="157,55 145,59 145,50" style="fill:rgb(0,0,0)"/>
<path d="M119,55L151,55"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M157,55 L 164,55 Q 172,55 172,40 L 172,32 Q 172,17 179,17 L 187,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="309,47 297,51 297,43" style="fill:rgb(0,0,0)"/>
<path d="M202,17 L 209,17 Q 217,17 217,32 L 217,32 Q 217,47 232,47 L 288,47 L 303,47"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M309,47 L 380,47 Q 395,47 395,32 L 395,32 Q 395,17 402,17 L 410,17"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
</svg>
</div>
</div>
<p><b><a href="syntax/rollback-stmt.html">rollback-stmt:</a></b> <button
id='x908cc22b' onclick='hideorshow("x908cc22b","x2982a3ff")'>hide</button></p>
 <div id='x2982a3ff' class='imgcontainer'>
 <div style="max-width:801px"><svg xmlns='http://www.w3.org/2000/svg' class="pikchr" viewBox="0 0 801.734 67.392">
<circle cx="5" cy="33" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="32,33 20,38 20,29" style="fill:rgb(0,0,0)"/>
<path d="M9,33L26,33"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M47,48L125,48A15 15 0 0 0 140 33A15 15 0 0 0 125 18L47,18A15 15 0 0 0 32 33A15 15 0 0 0 47 48Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="86" y="33" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">ROLLBACK</text>
<polygon points="176,33 164,38 164,29" style="fill:rgb(0,0,0)"/>
<path d="M140,33L170,33"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M191,48L303,48A15 15 0 0 0 318 33A15 15 0 0 0 303 18L191,18A15 15 0 0 0 176 33A15 15 0 0 0 191 48Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="247" y="33" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">TRANSACTION</text>
<polygon points="390,33 378,38 378,29" style="fill:rgb(0,0,0)"/>
<path d="M318,33L384,33"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M405,48L411,48A15 15 0 0 0 426 33A15 15 0 0 0 411 18L405,18A15 15 0 0 0 390 33A15 15 0 0 0 405 48Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="408" y="33" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">TO</text>
<polygon points="462,33 450,38 450,29" style="fill:rgb(0,0,0)"/>
<path d="M426,33L456,33"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M477,48L561,48A15 15 0 0 0 576 33A15 15 0 0 0 561 18L477,18A15 15 0 0 0 462 33A15 15 0 0 0 477 48Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="519" y="33" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">SAVEPOINT</text>
<polygon points="612,33 601,38 601,29" style="fill:rgb(0,0,0)"/>
<path d="M576,33L606,33"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M627,48L741,48A15 15 0 0 0 756 33A15 15 0 0 0 741 18L627,18A15 15 0 0 0 612 33A15 15 0 0 0 627 48Z"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<text x="684" y="33" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">savepoint-name</text>
<polygon points="792,33 780,38 780,29" style="fill:rgb(0,0,0)"/>
<path d="M756,33L786,33"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<circle cx="795" cy="33" r="3.6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="519,6 507,10 507,2" style="fill:rgb(0,0,0)"/>
<path d="M426,33 L 433,33 Q 441,33 441,20 Q 441,6 456,6 L 498,6 L 513,6"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M519,6 L 576,6 Q 591,6 591,20 Q 591,33 599,33 L 606,33"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="519,60 507,65 507,56" style="fill:rgb(0,0,0)"/>
<path d="M352,33 L 359,33 Q 367,33 367,47 Q 367,60 382,60 L 498,60 L 513,60"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M519,60 L 756,60 Q 771,60 771,47 Q 771,33 778,33 L 786,33"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<polygon points="247,60 235,65 235,56" style="fill:rgb(0,0,0)"/>
<path d="M140,33 L 147,33 Q 155,33 155,47 Q 155,60 170,60 L 226,60 L 241,60"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
<path d="M247,60 L 318,60 Q 333,60 333,47 Q 333,33 340,33 L 348,33"  style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);" />
</svg>
</div>
</div>


<h1 id="transactions"><span>2. </span>トランザクション</h1>

<p>
トランザクション内除き、読み取りやは書き込みは発生しません。 データベースにアクセスするすべてのコマンド(基本的に、 いくつかの <a
href="pragma.html#syntax">PRAGMA</a> 文を除くすべての SQL
コマンド)は、トランザクションがまだ有効になっていない場合、自動的にトランザクションを開始します。 最後の SQL
文が終了すると、開始されたトランザクションは自動的にコミットされます。
</p>

<p>
トランザクションは、 BEGIN コマンドを使用して手動で開始できます。 このようなトランザクションは通常、 次の COMMIT または
ROLLBACK コマンドまで存続します。しかし、 データベースが閉じられている場合、またはエラーが発生し、かつ、 ROLLBACK
競合解決アルゴリズムが指定されている場合、 トランザクションは ROLLBACK も実行します。 ROLLBACK
競合解決アルゴリズムの詳細については、 <a href="lang_conflict.html">ON CONFLICT</a>
句に関する文書を参照してください。
</p>

<p>
END TRANSACTION は COMMIT の別名(alias)です。
</p>

<p> BEGIN...COMMIT を使用して作成されたトランザクションはネスト(入れ子)しません。 ネスト(入れ子)されたトランザクションには <a
href="lang_savepoint.html">SAVEPOINT</a> と <a
href="lang_savepoint.html">RELEASE</a> コマンドを使用します。 上記構文図の ROLLBACK コマンドの "TO
SAVEPOINT <span class='yyterm'>name</span>" は <a
href="lang_savepoint.html">SAVEPOINT</a> トランザクションにのみ適用されます。 トランザクション内で BEGIN
コマンドを呼び出そうとすると、 トランザクションが <a href="lang_savepoint.html">SAVEPOINT</a>
によって開始されたか、あるいは以前の BEGIN によって開始されたかに関係なく、エラーで失敗します。 TO 句を指定しない COMMIT コマンドと
ROLLBACK コマンドは、BEGIN によって開始されたトランザクションの場合と同様に、 <a
href="lang_savepoint.html">SAVEPOINT</a> トランザクションでも同じように機能します。</p>

<h2 id="read_transactions_versus_write_transactions"><span>2.1. </span>読み取りトランザクション V.S 書き込みトランザクション</h2>

<p>SQLite は、
別々のデータベース接続からの複数の同時読み取りトランザクションをサポートし、読み取りトランザクションは別々のスレッドまたはプロセスである可能性がありますが、
同時書き込みトランザクションは 1 つだけです。
</p><p>

</p><p>読み取りトランザクションは読み取り専用です。 書き込みトランザクションでは、読み取りと書き込みの両方が可能です。 読み取りトランザクションは
SELECT ステートメントによって開始され、 書き込みトランザクションは CREATE、DELETE、DROP、INSERT、UPDATE などの文
(まとめて「書き込み文」(write statements)と呼ぶ)によって開始されます。
読み取りトランザクションがアクティブなときに書き込み文が発生した場合、
可能であれば、読み取りトランザクションは書き込みトランザクションにアップグレードされます。
他のデータベース接続が既にデータベースを変更しているか、データベースを変更中の場合、
書き込みトランザクションへのアップグレードは不可能であり、書き込みステートメントは <a
href="rescode.html#busy">SQLITE_BUSY</a> で失敗します。
</p>

<p>
読み取りトランザクションがアクティブである間、 別のデータベース接続によって行われたデータベースへの変更は、
読み取りトランザクションを開始したデータベース接続に現れません。 データベース接続 X が読み取りトランザクションを保持している場合、 X
のトランザクションがまだ開いている間に他のデータベース接続 Y がデータベースの内容を変更する可能性がありますが、 X
はトランザクションが終了するまでそれらの変更を確認できません。 読み取りトランザクションがアクティブである間、X は、Y
によって変更される前のデータベースの履歴スナップショットを引き続き表示します。
</p>


<a name="immediate"></a>

<h2 id="deferred_immediate_and_exclusive_transactions"><span>2.2. </span>DEFERRED トランザクションと IMMEDIATE トランザクションと EXCLUSIVE トランザクション</h2>

<p>
トランザクションは、 DEFERRED (意味:延期・据え置き) または IMMEDIATE (意味:即時) または EXCLUSIVE
(意味:排他的) のいずれかにできます。 デフォルトのトランザクションの振る舞いは DEFERRED です。
</p>

<p>
DEFERRED は、 データベースが最初にアクセスされるまでトランザクションが実際には開始されないことを意味します。 内部的には、 BEGIN
DEFERRED 文は、 最後の文が終了したときに通常発生する自動コミットをオフにするフラグをデータベース接続に設定するだけです。 これにより、
自動的に開始されたトランザクションは、 明示的な COMMIT または ROLLBACK まで、またはエラーまたは ON CONFLICT
ROLLBACK 句によってロールバックが引き起こされるまで持続します。 BEGIN DEFERRED の後の最初の文が SELECT の場合、
読み取りトランザクションが開始されます。 後続の書き込み文は、可能であればトランザクションを書き込みトランザクションにアップグレードするか、
SQLITE_BUSY を返します。 BEGIN DEFERRED の後の最初の文が書き込み文である場合、書き込みトランザクションが開始されます。
</p>

<p>
IMMEDIATE は、書き込み文まで待つことをせずに、データベース接続が新しい書き込みを即座開始するようにします。
別のデータベース接続で別の書き込みトランザクションが既にアクティブになっている場合、 BEGIN IMMEDIATE は <a
href="rescode.html#busy">SQLITE_BUSY</a> で失敗する可能性があります。
</p>

<p>
EXCLUSIVE は、書き込みトランザクションが即座に開始されるという点で IMMEDIATE に似ています。 EXCLUSIVE と
IMMEDIATE は <a href="wal.html">WAL モード</a>では全く同じですが、
他のジャーナリング・モード(journaling modes)で EXCLUSIVE
を使用すると、トランザクションの進行中は他のデータベース接続がデータベースを読み取ることができなくなります。
</p>

<h2 id="implicit_versus_explicit_transactions"><span>2.3. </span>暗黙のトランザクション V.S. 明示的トランザクション</h2>

<p>
暗黙のトランザクション (BEGIN によって開始されるトランザクションではなく、自動的に開始されるトランザクション)
は、最後のアクティブなSQL文(statement)が終了すると自動的にコミットされます。
SQL文(statement)は最後のカーソルが閉じたときに終了します。 自動的なコミットは、準備済 SQL 文(prepared
statement)が <a href="c3ref/reset.html">reset</a> または <a
href="c3ref/finalize.html">finalize</a> されたときに起こることが保証されています。
一部のSQL文(statement)は、トランザクション制御の目的で、 reset または finalize
される前に終了する場合がありますが、その際に自動的にコミットされる保証はありません。 SQL文(statement)が finish
したことを確認する唯一の方法は、そのSQL文(statement)で <a
href="c3ref/reset.html">sqlite3_reset()</a> または <a
href="c3ref/finalize.html">sqlite3_finalize()</a> を呼び出すことです。インクリメンタル BLOB
I/O に使用される、開いている <a href="c3ref/blob.html">sqlite3_blob</a>
も、未完了のSQL文(statement)としてカウントされます。 <a href="c3ref/blob.html">sqlite3_blob</a>
は、 <a href="c3ref/blob_close.html">BLOB を閉じた</a>ときに終了します。
</p>

<p>
保留中の <a href="lang_select.html">SELECT</a> 文がある場合でも、 明示的な COMMIT
コマンドは即座に実行されます。 ただし、 保留中の書き込み操作がある場合、COMMIT コマンドはエラー・コード <a
href="rescode.html#busy">SQLITE_BUSY</a> で失敗します。
</p>

<p>
別のスレッドまたはプロセスが開いている読み取り接続を開いている場合、 COMMIT を実行しようとすると、 <a
href="rescode.html#busy">SQLITE_BUSY</a> リターン・コードが返されることもあります。 この方法で COMMIT
が失敗した場合、 トランザクションはアクティブなままであり、 読み取り接続側のクリア後の機会で COMMIT を再試行できます。
</p>

<p>
非常に古いバージョンの SQLite (バージョン 3.7.11、2012/03/20より前) では、 保留中のクエリ(pending
queries)がある場合、 ROLLBACK はエラー・コード <a href="rescode.html#busy">SQLITE_BUSY</a>
で失敗します。 SQLite の最近のバージョンでは、 ROLLBACK が続行され、
保留中(pending)のSQL文(statement)が中止されることが多く、 <a
href="rescode.html#abort">SQLITE_ABORT</a> または <a
href="rescode.html#abort_rollback">SQLITE_ABORT_ROLLBACK</a> エラーが返されます。
SQLite バージョン 3.8.8 (2015-01-16) 以降では、 保留中(pending)の読み取りは、 ROLLBACK
がデータベース・スキーマを変更しない限り、 ROLLBACK の後も引き続き機能します。
</p>

<p>
<a href="pragma.html#pragma_journal_mode">PRAGMA journal_mode</a> が OFF
に設定されている(つまり、ロールバック・ジャーナル・ファイルが無効になっている) 場合、 ROLLBACK コマンドの動作は未定義です。
</p>

<h1 id="response_to_errors_within_a_transaction"><span>3. </span>トランザクション内エラーへの対応</h1>

<p> トランザクション内で特定の種類のエラーが発生した場合、トランザクションは自動的にロールバックされる場合とされない場合があります。
自動ロールバックを引き起こす可能性のあるエラーには、以下のものがあります:</p>

<ul>
<li> <a href="rescode.html#full">SQLITE_FULL</a>: データベースまたはディスクが満杯(full)です
</li><li> <a href="rescode.html#ioerr">SQLITE_IOERR</a>: ディスク I/O エラーです
</li><li> <a href="rescode.html#busy">SQLITE_BUSY</a>: 別のプロセスで使用中のデータベースです
</li><li> <a href="rescode.html#nomem">SQLITE_NOMEM</a>: メモリーが足りません。
</li></ul>

<p>
これらすべてのエラーに対して、 SQLite は、作業していた 1 つのSQL文(statement)を元に戻し(undo)、
同じトランザクション内のそれ以前のSQL文(statement)からの変更をそのままにして、 トランザクションを続行しようとします。
ただし、評価されるSQL文(statement)とエラーが発生する箇所によっては、 SQLite
がトランザクション全体をロールバックしてキャンセルする必要がある場合があります。 アプリケーションは、 C 言語インターフェースの<a
href="c3ref/get_autocommit.html">sqlite3_get_autocommit()</a> を使用して、 SQLite
が実行した一連のアクションを知ることができます。</p>

<p>アプリケーションでは、 上記のようなエラーに対して、 明示的にROLLBACKコマンドを発行して対応することが推奨されます。
エラー処理によってトランザクションがすでに自動的にロールバックされている場合、
ROLLBACKコマンドはエラーで失敗するけれども、これによる害はありません。</p>

<p>SQLite の将来のバージョンでは、
自動トランザクション・ロールバックを引き起こす可能性あるエラーに対応するエラーのリストが拡張される可能性があります。 SQLite
の将来のバージョンでは、エラー処理が変更される可能性があります。 特に、 SQLite の将来のバージョンでは、
上記のエラーを発生させて無条件のロールバックを強制することにより、 インターフェイスを簡素化することを選択する可能性があります。</p>
<p align="center"><small><i>This page last modified on <a
href="https://sqlite.org/docsrc/honeypot" id="mtimelink"
data-href="https://sqlite.org/docsrc/finfo/pages/lang_transaction.in?m=44e02f89eb">2022-01-08
05:02:57</a> UTC </i></small></p>

